# Synonym and Related Terms Fix Plan

## 1. Analysis: Why This Is Happening

### Root Causes

1. **Loose Semantic Similarity Thresholds**
   - Current: Synonyms require >0.85 similarity, Related requires 0.5-0.85
   - Problem: Words like "fun", "bold", "electric" can have 0.85+ similarity to "colorful" but aren't true synonyms
   - They're related concepts, not the same concept

2. **Relationship-Based Logic Issues**
   - `findRelatedFromRelationships` adds concepts that share opposites
   - This can incorrectly add opposites to related (e.g., "colorless" in "colorful" related)
   - Logic: "If A and B share an opposite, they're related" - but this doesn't account for transitive relationships

3. **Simple Generation Functions**
   - `generateSynonymsForConcept` only does basic word transformations (e.g., "playful" â†’ "playfulic")
   - `generateRelatedForConcept` just adds other category examples
   - No semantic validation or opposite checking

4. **No Explicit Opposite Filtering**
   - When adding synonyms/related, there's no check to ensure they're not opposites
   - The check exists in `map_existing_synonyms_and_related.ts` but may not catch all cases

5. **Gemini/OpenAI Don't Generate Synonyms/Related**
   - Gemini only generates concepts and opposites
   - Synonyms/related are generated by simple functions, not LLMs with proper instructions

### Example: "Colorful" Issues

**Current State:**
- Synonyms include: "fun", "bold", "electric", "full" (should be related)
- Related includes: "colorless" (should be opposite, not related)
- Synonyms include: "colorless" (should be removed entirely)

**What Should Be:**
- Synonyms: Only words that mean THE SAME THING (e.g., "vibrant", "multicolor", "polychrome")
- Related: Closely associated but distinct (e.g., "gradient", "rainbow", "palette", "saturated")
- Opposites: Contradictory concepts (e.g., "colorless", "monochrome", "drab")

---

## 2. Plan to Avoid This

### A. Strengthen Semantic Similarity Thresholds

**Current:**
- Synonyms: >0.85 similarity
- Related: 0.5-0.85 similarity

**New:**
- Synonyms: >0.90 similarity (very strict - must be essentially the same concept)
- Related: 0.65-0.90 similarity (related but distinct)
- Below 0.65: Too different, don't add

### B. Add Explicit Opposite Checking

**Rules:**
1. Before adding ANY synonym or related term, check if it's an opposite
2. Use `hasOppositeTags()` function to check for opposite relationships
3. If it's an opposite, DO NOT add it to synonyms or related
4. Check both directions (A opposite of B, and B opposite of A)

### C. Improve Generation Functions

**For Synonyms:**
- Use semantic similarity (0.90+) instead of word transformations
- Only add if truly the same concept
- Check against opposites before adding

**For Related:**
- Use semantic similarity (0.65-0.90)
- Check against opposites before adding
- Prefer concepts that share category or have similar contexts

### D. Strengthen Relationship-Based Logic

**Current Issue:**
- "Concepts that share opposites are related" can add opposites

**Fix:**
- When finding related from relationships, explicitly exclude opposites
- Double-check with `hasOppositeTags()` before adding

### E. Add Validation in Pipeline

**When creating new concepts:**
1. Generate synonyms/related using improved functions
2. Validate against opposites
3. Remove any contradictions before saving

**When updating existing concepts:**
1. Check all synonyms/related against opposites
2. Remove contradictions
3. Re-validate semantic similarity thresholds

---

## 3. Implementation Plan

### Step 1: Update `map_existing_synonyms_and_related.ts`
- Increase synonym threshold to 0.90
- Adjust related threshold to 0.65-0.90
- Add explicit opposite checking before adding synonyms/related
- Strengthen relationship-based logic to exclude opposites

### Step 2: Update `generateSynonymsForConcept` and `generateRelatedForConcept`
- Use semantic similarity instead of simple transformations
- Add opposite checking
- Make them async to support embedding lookups

### Step 3: Create Cleanup Script
- Find all concepts with opposites in synonyms/related
- Remove contradictions
- Re-validate semantic similarity
- Report statistics

### Step 4: Update Pipeline
- Add validation step after generating synonyms/related
- Check against opposites before saving
- Log any contradictions found

---

## 4. Cleanup Script Plan

### Script: `scripts/fix_synonym_related_contradictions.ts`

**What it does:**
1. Load all concepts from `seed_concepts.json`
2. For each concept:
   - Check if any synonyms are opposites
   - Check if any related are opposites
   - Remove contradictions
   - Re-validate semantic similarity (remove synonyms <0.90, related outside 0.65-0.90)
3. Save updated concepts
4. Report statistics

**Output:**
- Number of concepts fixed
- Number of synonyms removed (contradictions + low similarity)
- Number of related removed (contradictions + low similarity)
- Examples of fixes

